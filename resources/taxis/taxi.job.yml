resources:
  jobs:
    taxis_etl_pipeline:
      name: "[${bundle.target}] ETL Taxis NY"
      description: "ETL pipeline for processing NYC taxi data"
      tasks:
        - task_key: unit_tests
          existing_cluster_id: 1209-011215-whfxnfs2
          description: "Run unit tests for taxi ETL notebooks"
          spark_python_task:
            python_file: "../../tests/taxis/test_taxis.py"
          libraries:
            - pypi:
                package: "pytest"
        - task_key: bronze_task
          existing_cluster_id: 1209-011215-whfxnfs2
          description: "Ingest raw taxi data into bronze layer"
          notebook_task:
            notebook_path: "../../src/taxis_etl/01_bronze.ipynb"
          depends_on:
            - task_key: unit_tests
        - task_key: silver_task
          existing_cluster_id: 1209-011215-whfxnfs2
          description: "Transform bronze data into silver layer"
          notebook_task:
            notebook_path: "../../src/taxis_etl/02_silver.ipynb"
          depends_on:
            - task_key: bronze_task
        - task_key: gold_task
          existing_cluster_id: 1209-011215-whfxnfs2
          description: "Aggregate silver data into gold layer"
          notebook_task:
            notebook_path: "../../src/taxis_etl/03_gold.ipynb"
          depends_on:
            - task_key: silver_task